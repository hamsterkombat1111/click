<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–∫–µ—Ä - –õ–∏–¥–µ—Ä–±–æ—Ä–¥</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h1>
            <div class="auth-state">
                <a href="game.html" class="btn">üéÆ –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∏–≥—Ä—É</a>
                <a href="index.html" class="btn btn-secondary">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            </div>
        </header>
        
        <main class="main-content">
            <div class="leaderboard-container">
                <h2>–¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤</h2>
                <div id="leaderboardList" class="leaderboard-list">
                    <div class="leaderboard-item header">
                        <span>–ú–µ—Å—Ç–æ</span>
                        <span>–ò–≥—Ä–æ–∫</span>
                        <span>–ö–ª–∏–∫–∏</span>
                        <span>–û–±–Ω–æ–≤–ª–µ–Ω–æ</span>
                    </div>
                    <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
                
                <div class="leaderboard-actions">
                    <button id="refreshBtn" class="btn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>
        </main>
        
        <footer>
            <p>Epic Clicker | Live –ª–∏–¥–µ—Ä–±–æ—Ä–¥</p>
        </footer>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
        const SUPABASE_URL = 'https://ghpcfjbissjxazdepndr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdocGNmamJpc3NqeGF6ZGVwbmRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyMTU0NzgsImV4cCI6MjA3Mjc5MTQ3OH0.7K84ZwQVZ07Ode98druvxnrR9HbjMpotegorn1Ncex8';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        document.addEventListener('DOMContentLoaded', function() {
            loadLeaderboard();
            
            document.getElementById('refreshBtn').addEventListener('click', loadLeaderboard);
        });

        async function loadLeaderboard() {
            try {
                const { data: leaderboard, error } = await supabase
                    .from('leaderboard')
                    .select('*')
                    .order('total_clicks', { ascending: false })
                    .limit(10);
                
                if (error) throw error;
                
                const leaderboardList = document.getElementById('leaderboardList');
                leaderboardList.innerHTML = `
                    <div class="leaderboard-item header">
                        <span>–ú–µ—Å—Ç–æ</span>
                        <span>–ò–≥—Ä–æ–∫</span>
                        <span>–ö–ª–∏–∫–∏</span>
                        <span>–û–±–Ω–æ–≤–ª–µ–Ω–æ</span>
                    </div>
                `;
                
                leaderboard.forEach((player, index) => {
                    const item = document.createElement('div');
                    item.className = 'leaderboard-item';
                    item.innerHTML = `
                        <span class="rank">#${index + 1}</span>
                        <span class="username">${player.username}</span>
                        <span class="clicks">${player.total_clicks.toLocaleString()}</span>
                        <span class="time">${new Date(player.last_updated).toLocaleTimeString()}</span>
                    `;
                    
                    // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                    if (currentUser && currentUser.id === player.user_id) {
                        item.classList.add('current-user');
                    }
                    
                    // –í—ã–¥–µ–ª—è–µ–º —Ç–æ–ø-3
                    if (index < 3) {
                        item.classList.add(`top-${index + 1}`);
                    }
                    
                    leaderboardList.appendChild(item);
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞:', error);
            }
        }
    </script>
</body>
</html>