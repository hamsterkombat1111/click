<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–∫–µ—Ä - –ì–ª–∞–≤–Ω–∞—è</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>–ö–ª–∏–∫–µ—Ä</h1>
            <div id="authState" class="auth-state">
                <span id="userGreeting"></span>
                <button id="authButton" class="btn" style="display: none;">–í–æ–π—Ç–∏</button>
            </div>
        </header>
        
        <main class="main-content">
            <div class="welcome-text">
                <h2>–ö–ª–∏–∫–Ω–∏ –ø—É—Ç—å –∫ —Å–ª–∞–≤–µ! üèÜ</h2>
                <p>–°–æ—Ä–µ–≤–Ω—É–π—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏ –∏ —Å—Ç–∞–Ω—å –∫–æ—Ä–æ–ª–µ–º –∫–ª–∏–∫–æ–≤!</p>
            </div>
            
            <div class="stats-preview">
                <div class="stat-card">
                    <h3>üéØ –¢–æ–ø-1 –∏–≥—Ä–æ–∫</h3>
                    <span id="topPlayer">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <div class="stat-card">
                    <h3>üî• –í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤</h3>
                    <span id="totalClicks">0</span>
                </div>
            </div>
            
            <div class="auth-buttons">
                <a href="login.html" class="btn">–í—Ö–æ–¥</a>
                <a href="register.html" class="btn btn-secondary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>
            
            <div class="features">
                <div class="feature-card">
                    <h3>üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥</h3>
                    <p>–°–º–æ—Ç—Ä–∏ –∫—Ç–æ –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ</p>
                </div>
                <div class="feature-card">
                    <h3>üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</h3>
                    <p>–¢–≤–æ–∏ –∫–ª–∏–∫–∏ –≤—Å–µ–≥–¥–∞ —Å —Ç–æ–±–æ–π</p>
                </div>
                <div class="feature-card">
                    <h3>‚ö° –ë—ã—Å—Ç—Ä–æ</h3>
                    <p>–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</p>
                </div>
            </div>
        </main>
        
        <footer>
            <p>Epic Clicker | Supabase + PostgreSQL</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ Supabase –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
            if (typeof supabase === 'undefined') {
                document.getElementById('topPlayer').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                document.getElementById('totalClicks').textContent = '0';
                return;
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
            const SUPABASE_URL = 'https://ghpcfjbissjxazdepndr.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdocGNmamJpc3NqeGF6ZGVwbmRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyMTU0NzgsImV4cCI6MjA3Mjc5MTQ3OH0.7K84ZwQVZ07Ode98druvxnrR9HbjMpotegorn1Ncex8';
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            const authButton = document.getElementById('authButton');
            const userGreeting = document.getElementById('userGreeting');
            
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            
            if (currentUser) {
                userGreeting.textContent = `–ü—Ä–∏–≤–µ—Ç, ${currentUser.username}!`;
                authButton.textContent = '–í—ã–π—Ç–∏';
                authButton.onclick = () => {
                    sessionStorage.removeItem('currentUser');
                    window.location.reload();
                };
                setTimeout(() => window.location.href = 'game.html', 2000);
            } else {
                userGreeting.textContent = '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!';
                authButton.textContent = '–í–æ–π—Ç–∏';
                authButton.onclick = () => window.location.href = 'login.html';
            }
            authButton.style.display = 'inline-block';
            
            loadStats(supabaseClient);
        });

        async function loadStats(supabaseClient) {
            try {
                const { data: leaderboard } = await supabaseClient
                    .from('leaderboard')
                    .select('*')
                    .order('total_clicks', { ascending: false })
                    .limit(1);
                
                if (leaderboard && leaderboard.length > 0) {
                    document.getElementById('topPlayer').textContent = 
                        `${leaderboard[0].username} (${leaderboard[0].total_clicks} –∫–ª–∏–∫–æ–≤)`;
                }
                
                const { data: total } = await supabaseClient
                    .from('user_clicks')
                    .select('clicks');
                
                if (total) {
                    const totalClicks = total.reduce((sum, item) => sum + item.clicks, 0);
                    document.getElementById('totalClicks').textContent = totalClicks.toLocaleString();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
    </script>
</body>
</html>